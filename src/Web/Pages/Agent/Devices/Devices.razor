@page "/agents/devices/{serviceId}"
@using SDK.Authorization
@attribute [Authorize(Roles = $"{Roles.Administrator}, {Roles.Engineer}, {Roles.Reviewer}")]

@if (string.IsNullOrEmpty(_serviceName))
{
    <PageTitle>AyBorg - Devices</PageTitle>
}
else
{
    <PageTitle>AyBorg - Devices (@_serviceName)</PageTitle>
}

<AyBorg.Web.Shared.Alerts.ServiceOfflineAlert IsVisible="@_hasServiceError" />
<div class="page-loading-bar">
    <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-0" hidden="@(!_isLoading)" />
</div>

<MudGrid class="pt-1">
    <MudItem xs="12">
        <MudCard Class="rounded-lg">
            <MudCardHeader>
                <CardHeaderAvatar>
                    <MudIcon Icon="@Icons.Material.Filled.DeviceHub" Size="Size.Large" Color="Color.Default" />
                </CardHeaderAvatar>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Devices</MudText>
                </CardHeaderContent>
                 <CardHeaderActions>
                    <MudButton class="pt-3" Variant="Variant.Text" StartIcon="@Icons.Filled.AddBox" Color="Color.Primary" OnClick="@OnAddDeviceClicked">Add Device</MudButton>
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent>
                <MudTable Items="@_devices" Hover="true" Elevation="0">
                    <HeaderContent>
                        <MudTh Style="width: 30px">Active</MudTh>
                        <MudTh Style="width: 30px">Connected</MudTh>
                        <MudTh>Id</MudTh>
                        <MudTh>Name</MudTh>
                        <MudTh Style="width: 30%">Categories</MudTh>
                        <MudTh Style="width: 30px">Actions</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Active">
                            @if (@context.IsActive)
                            {
                                <MudIcon Icon="@Icons.Filled.Check" />
                            }
                        </MudTd>
                        <MudTd DataLabel="Connected">
                            @if (@context.IsConnected)
                            {
                                <MudIcon Icon="@Icons.Filled.Check" />
                            }
                        </MudTd>
                        <MudTd DataLabel="Id">@context.Id</MudTd>
                        <MudTd DataLabel="Name">@context.Name</MudTd>
                        <MudTd DataLabel="Categories">
                            @foreach (var category in @context.Categories.Order())
                            {
                                <MudChip Size="Size.Small" Text="@category" Disabled/>
                            }
                        </MudTd>
                        <MudTd DataLabel="Actions">
                            <MudMenu Icon="@Icons.Material.Filled.MoreVert" AnchorOrigin="Origin.BottomRight">

                            </MudMenu>
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>
